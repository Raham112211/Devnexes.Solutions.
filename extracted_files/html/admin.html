<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - DevNexes Solutions</title>
    <link rel="stylesheet" href="modern-admin.css">
    <link rel="stylesheet" href="admin-styles-update.css">
    <link rel="stylesheet" href="admin-requests.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="admin-container">
        <!-- Login Form -->
        <div id="loginForm" class="login-form">
            <div class="login-card">
                <h2>Admin Access</h2>
                <form id="adminLogin">
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="password" id="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
            </div>
        </div>

        <!-- Admin Choice Selection -->
        <div id="adminChoice" class="admin-choice" style="display: none;">
            <div class="choice-container">
                <h2>Admin Panel</h2>
                <p>What would you like to do?</p>
                <div class="choice-buttons">
                    <button class="choice-btn" onclick="showSection('projects')">
                        <i class="fas fa-plus-circle"></i>
                        <span>Add/Manage Projects</span>
                    </button>
                    <button class="choice-btn" onclick="showSection('requests')">
                        <i class="fas fa-inbox"></i>
                        <span>View Project Requests</span>
                    </button>
                </div>
                <button id="logoutBtn" class="logout-btn">Logout</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="admin-dashboard" style="display: none;">
            <header class="admin-header">
                <h1 id="dashboardTitle">Project Control Panel</h1>
                <div class="header-actions">
                    <button id="backBtn" class="back-btn" onclick="showChoice()">Back</button>
                    <button id="logoutBtn2" class="logout-btn">Logout</button>
                </div>
            </header>

            <div class="dashboard-content">
                <!-- Project Requests Section -->
                <div id="requestsSection" class="requests-section" style="display: none;">
                    <h3>Client Project Requests</h3>
                    <div class="requests-container" id="requestsContainer">
                        <!-- Requests will be loaded here -->
                    </div>
                </div>

                <!-- Add New Project -->
                <div id="projectsSection" class="add-project-section" style="display: none;">
                    <h3>Add New Project</h3>
                    <form id="addProjectForm">
                        <input type="text" id="projectTitle" placeholder="Project Title" required>
                        <input type="text" id="projectDesc" placeholder="Project Description" required>

                        <select id="projectStatus" required onchange="toggleFileUpload()">
                            <option value="">Select Status</option>
                            <option value="latest">Open Source Project</option>
                            <option value="progress">In Progress</option>
                            <option value="upcoming">Upcoming</option>
                        </select>
                        
                        <div class="image-upload-section" id="imageUploadSection" style="display: none;">
                            <h4><i class="fas fa-image"></i> Project Image</h4>
                            <div class="image-upload-container">
                                <input type="file" id="projectImage" accept="image/*" style="display: none;">
                                <div class="image-upload-box" id="imagePreview" onclick="document.getElementById('projectImage').click()">
                                    <div class="upload-placeholder">
                                        <i class="fas fa-camera"></i>
                                        <h5>Add Project Image</h5>
                                        <p>Click to browse or drag & drop</p>
                                        <span class="supported-formats">JPG, PNG, GIF up to 5MB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="file-upload-section" id="fileUploadSection" style="display: none;">
                            <h4><i class="fas fa-file-upload"></i> Upload Project Files</h4>
                            <div class="file-drop-box" id="uploadArea">
                                <div class="drop-message" id="dropMessage">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <span>Drag & Drop files here</span>
                                    <div class="import-section">
                                        <span class="or-text">or</span>
                                        <button type="button" class="import-btn" onclick="selectFiles()">
                                            <i class="fas fa-folder-open"></i>
                                            Browse Files
                                        </button>
                                    </div>
                                </div>
                                <div class="files-list" id="filesList" style="display: none;"></div>
                                <input type="file" id="fileInput" multiple accept="*/*" style="display: none;">
                            </div>
                            <div id="selectedItems" class="selected-items"></div>
                        </div>
                        <button type="submit" id="submitBtn">Add Project</button>
                    </form>
                </div>

                <!-- Projects List (Only show in projects section) -->
                <div class="projects-list" id="projectsList" style="display: none;">
                    <h3>Current Projects</h3>
                    <div id="projectsContainer">
                        <!-- Projects will be loaded here -->
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/js/admin-script.js"></script>
    <script>
        function showChoice() {
            document.getElementById('adminChoice').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
        }

        function showSection(section) {
            document.getElementById('adminChoice').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            if (section === 'projects') {
                document.getElementById('dashboardTitle').textContent = 'Project Management';
                document.getElementById('projectsSection').style.display = 'block';
                document.getElementById('requestsSection').style.display = 'none';
                document.getElementById('projectsList').style.display = 'block';
                loadProjects();
            } else if (section === 'requests') {
                document.getElementById('dashboardTitle').textContent = 'Client Project Requests';
                document.getElementById('projectsSection').style.display = 'none';
                document.getElementById('requestsSection').style.display = 'block';
                document.getElementById('projectsList').style.display = 'none';
                loadProjectRequests();
            }
        }

        async function loadProjectRequests() {
            try {
                const response = await fetch('/api/project-requests');
                const data = await response.json();
                displayProjectRequests(data.requests || []);
            } catch (error) {
                console.error('Error loading requests:', error);
            }
        }

        function displayProjectRequests(requests) {
            const container = document.getElementById('requestsContainer');
            
            if (requests.length === 0) {
                container.innerHTML = '<div class="no-requests"><p>No project requests found</p></div>';
                return;
            }

            const requestsHtml = requests.map(request => `
                <div class="request-card">
                    <div class="request-header">
                        <h4>${request.project_title}</h4>
                        <span class="request-status ${request.status}">${request.status}</span>
                    </div>
                    <div class="request-info">
                        <p><strong>Client:</strong> ${request.client_name}</p>
                        <p><strong>Email:</strong> ${request.client_email}</p>
                        <p><strong>Type:</strong> ${request.project_type}</p>
                        <p><strong>Budget:</strong> ${request.budget || 'Not specified'}</p>
                        <p><strong>Timeline:</strong> ${request.timeline || 'Not specified'}</p>
                    </div>
                    <div class="request-description">
                        <p><strong>Description:</strong></p>
                        <p>${request.project_description}</p>
                    </div>
                    <div class="request-actions">
                        <button onclick="respondToRequest(${request.id})" class="respond-btn">Respond</button>
                        <button onclick="updateRequestStatus(${request.id}, 'completed')" class="complete-btn">Mark Complete</button>
                    </div>
                    <div class="request-date">
                        <small>Submitted: ${new Date(request.created_at).toLocaleDateString()}</small>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = requestsHtml;
        }

        function respondToRequest(requestId) {
            const response = prompt('Enter your response to the client:');
            if (response) {
                // Here you would typically send an email or save the response
                alert('Response sent to client!');
                updateRequestStatus(requestId, 'responded');
            }
        }

        async function updateRequestStatus(requestId, status) {
            try {
                const response = await fetch(`/api/project-requests/${requestId}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status })
                });
                
                if (response.ok) {
                    loadProjectRequests();
                }
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }
    </script>
</body>
</html>
